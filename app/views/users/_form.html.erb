<%= form_with(model: user) do |form| %>
<div class="row justify-content-center">
  <div class="col-11 col-md-10 col-lg-4 px-3 px-md-0">
    <h1 style="font-family: 'Times New Roman', Times, serif; color: #b29c84; text-align: center; margin-top: 3rem; margin-bottom: 1rem; letter-spacing: 0.2em;">ROPER LAWYERS</h1>
    <div class="text-center m-3 ">
      <h2>Information required</h2>

<p>
  The following details are required by administrative bodies and notaries.<br>
  If you're unsure of any item, you can log in and update it later.<br>
  We'll be notified of any changes and will review them accordingly.
</p>

    </div>
    <div class="card p-5 mb-5 card-shadow">
  <h4 class="mb-3">Personal details</h4>

      <% if user.errors.any? %>
        <div id="error_explanation" class="alert alert-danger">
      <%= pluralize(user.errors.count, "error") %> prohibited this form from being saved:
            <ul>
        <% user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
              <% end %>
            </ul>
        </div>
      <% end %>


<div class="row mb-3 g-3">
  <div class="col-md-6">
    <div class="form-floating">
      <%= form.text_field :first_name, class: "form-control", placeholder: "First name" %>
      <%= form.label :first_name, "First name"%>
    </div>
        </div>
  <div class="col-md-6">
    <div class="form-floating">
      <%= form.text_field :last_name, class: "form-control", placeholder: "Last name" %>
      <%= form.label :last_name, "Last name"%>
        </div>
      </div>
          </div>

        <div class="form-floating mb-3">
    <%= form.text_field :email, class: "form-control", placeholder: "Email address" %>
    <%= form.label :email, "Email address" %>
        </div>

        <div class="form-floating mb-3">
    <%= form.text_field :mobile_phone, class: "form-control", placeholder: "Mobile phone number" %>
    <%= form.label :mobile_phone, "Mobile phone number" %>
        </div>

  <div class="form-floating mb-3">
    <%= form.text_field :home_address, class: "form-control", placeholder: "Home address" %>
    <%= form.label :home_address, "Home address" %>
  </div>
      <div class="form-floating mb-3">
    <%= form.text_field :profession, class: "form-control", placeholder: "Profession" %>
    <%= form.label :profession, "Profession" %>
  </div>

  <div class="row mb-3 g-3">
    <div class="col-md-6">
      <div class="form-floating">
        <%= form.text_field :marital_status, class: "form-control", placeholder: "Marital status" %>
        <%= form.label :marital_status, "Marital status" %>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-floating">
        <%= form.text_field :spouse, class: "form-control", placeholder: "Spouse full name" %>
        <%= form.label :spouse, "Spouse full name" %>
      </div>
    </div>
  </div>
    <p class="mt-3">Are you a tax resident in Spain?</p>
    <div class="form-check mb-3">
    <%= form.check_box :tax_resident, class: "form-check-input", id: "tax_resident" %>
    <%= form.label :tax_resident, "Yes – I am a tax resident in Spain", class: "form-check-label" %>
  </div>

  <div class="form-floating mb-3">
    <%= form.text_field :full_name_on_passport, class: "form-control", placeholder: "Full name on passport" %>
    <%= form.label :full_name_on_passport, "Full name on passport" %>
  </div>

  <div class="form-floating mb-3">
    <%= form.text_field :passport_number, class: "form-control", placeholder: "Passport number" %>
    <%= form.label :passport_number, "Passport number" %>
  </div>

  <div class="row mb-3 g-3">
    <div class="col-md-6">
      <div class="form-floating">
        <%= form.date_field :date_of_birth, class: "form-control", placeholder: "YYYY-MM-DD" %>
        <%= form.label :date_of_birth, "Date of birth"%>
      </div>
   </div>
    <div class="col-md-6">
      <div class="form-floating">
        <%= form.date_field :expiry_date, class: "form-control", placeholder: "Passport expiry date" %>
        <%= form.label :expiry_date, "Passport expiry date"%>
      </div>
    </div>
   </div>

     <div class="form-floating mb-3">
    <%= form.select :nationality,
          options_for_select(%w[Belgian British Chinese Danish Dutch Finnish French German Greek Indian Irish Italian Norwegian Polish Spanish Swedish Swiss Romanian], user.nationality),
          { include_blank: "Select" },
          class: "form-control form-select" %>
    <%= form.label :nationality, "Nationality" %>
   </div>

  <div class="mb-3">
    <p class="mb-1">Upload a copy of your passport</p>
    <div class="file-upload-container">
      <label for="user_passport_document" class="file-upload-label">
        <div class="upload-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
        </div>
        <span class="upload-text">Upload a file or drag & drop</span>
        <span class="file-types">PDF, JPG, PNG</span>
        <%= form.file_field :passport_document, class: "file-upload-input" %>
      </label>
    </div>
  </div>

<style>
  .file-upload-container {
    width: 100%;
  }
  .file-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 150px;
    border: 2px dashed #ccc;
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.3s ease;
  }
  .file-upload-label:hover {
    border-color: #999;
  }
  .upload-icon {
    font-size: 2rem;
    margin-bottom: 20px;
    color: #666;
    width: 1em;
    height: 1em;
  }
  .file-upload-input {
    position: absolute;
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    z-index: -1;
  }
  .upload-text {
    margin-bottom: 4px;
  }
  .file-types {
    font-size: 0.8rem;
    color: #666;
  }
</style>



<hr class="hr mb-3" style="color: #b29c84;" />
<%# NIE section %>

  <h4 class="mb-3 mt-3">NIE number</h4>
  <p class="mb-3">
    An NIE (Foreigner Identification Number) is required for most official processes in Spain, including legal, financial, and administrative transactions.
  </p>

  <fieldset class="mb-3">
    <legend class="col-form-label">Would you like us to apply for your NIE?</legend>

    <div class="form-check mb-2">
      <%= form.radio_button :needs_nie, 'no',
            id: 'needs_nie_no',
            class: 'form-check-input' %>
      <%= form.label :needs_nie_no,
            'No – I already have an NIE',
            class: 'form-check-label' %>
    </div>

    <div class="form-check">
      <%= form.radio_button :needs_nie, 'yes',
            id: 'needs_nie_yes',
            class: 'form-check-input' %>
      <%= form.label :needs_nie_yes,
            'Yes – please apply on my behalf',
            class: 'form-check-label' %>
    </div>
  </fieldset>

  <!-- hidden by default -->
  <div id="nie_fields" class="hidden-section">
    <div class="form-floating mb-3">
      <%= form.text_field :nie_number,
            class: "form-control",
            placeholder: "Enter your NIE number",
            autocomplete: "off" %>
      <%= form.label :nie_number, "NIE number" %>
    </div>
    <div class="mb-3">
      <label class="form-label">Upload a copy of your NIE document</label>
      <div class="file-upload-container">
        <label for="user_nie_document" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
          <span class="upload-text">Upload a file or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :nie_document, class: "file-upload-input" %>
        </label>
      </div>
    </div>
    </div>

  <!-- hidden by default -->
  <div id="parent_fields" class="hidden-section">
    <p class="mb-3">
      Please enter your parents' first names so we can apply for your NIE:
    </p>
    <div class="row mb-3 g-3">
      <div class="col-md-6">
        <div class="form-floating">
          <%= form.text_field :father_s_first_name,
                class: "form-control",
                placeholder: "Father's first name",
                autocomplete: "off" %>
          <%= form.label :father_s_first_name, "Father's first name" %>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-floating">
          <%= form.text_field :mother_s_first_name,
                class: "form-control",
                placeholder: "Mother's first name",
                autocomplete: "off" %>
          <%= form.label :mother_s_first_name, "Mother's first name" %>
        </div>
      </div>
    </div>
     </div>


<script>
  document.addEventListener("turbo:load", () => {
    const noRadio     = document.getElementById("needs_nie_no");
    const yesRadio    = document.getElementById("needs_nie_yes");
    const nieFields   = document.getElementById("nie_fields");
    const parentFields= document.getElementById("parent_fields");

    function toggleSections() {
      // When "No - I already have an NIE" is selected, show NIE fields
      if (noRadio.checked) {
        nieFields.classList.remove("hidden-section");
      } else {
        nieFields.classList.add("hidden-section");
      }
      
      // When "Yes - please apply on my behalf" is selected, show parent fields
      if (yesRadio.checked) {
        parentFields.classList.remove("hidden-section");
      } else {
        parentFields.classList.add("hidden-section");
      }
    }

    [noRadio, yesRadio].forEach(radio =>
      radio.addEventListener("change", toggleSections)
    );

    // Force hide both sections initially
    nieFields.classList.add("hidden-section");
    parentFields.classList.add("hidden-section");
    
    // Only call toggleSections if a radio is already checked (for page refresh/edit cases)
    if (noRadio.checked || yesRadio.checked) {
      toggleSections();
    }
  });
</script>
</div>

<div class="card p-5 mb-5 card-shadow">
  <h4 class="mb-3">Requested Services</h4>
  <p class="mb-3">Please tick all the services you would like us to assist you with:</p>
  
  <div class="mb-4">
    <h5 class="mb-2">Property Transactions</h5>
    <p class="mb-3">If you're buying or selling a property, please select the relevant option:</p>
    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_purchase" }, "Purchase", nil %>
      <%= form.label "requested_services_purchase", "I am purchasing a property", class: "form-check-label" %>
    </div>
    
    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_sale" }, "Sale", nil %>
      <%= form.label "requested_services_sale", "I am selling a property", class: "form-check-label" %>
    </div>
  </div>
  
  <div class="mb-4">
    <h5 class="mb-2">Legal Documents</h5>
    <p class="mb-3">If you would like us to prepare any of the following legal documents, please tick below:</p>
    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_will" }, "Will & Last Testament", nil %>
      <%= form.label "requested_services_will", "Will & Last Testament", class: "form-check-label" %>
    </div>
    
    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_new_build" }, "New Build Declaration", nil %>
      <%= form.label "requested_services_new_build", "New Build Declaration", class: "form-check-label" %>
    </div>
  </div>
  
  <div class="mb-3">
    <h5 class="mb-2">Holiday Let Compliance (Short-Term Rentals)</h5>

  <p class="mb-3">
If you plan to holiday let your property, three legal steps are required. Tick any you'd like us to handle:  </p>

    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_vv" }, "VV Licence", nil %>
      <%= form.label "requested_services_vv", "Apply for VV Licence", class: "form-check-label" %>
    </div>

    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_registry" }, "Unified Registry", nil %>
      <%= form.label "requested_services_registry", "Register with the Unified Registry", class: "form-check-label" %>
    </div>

    <div class="form-check ms-3">
      <%= form.check_box :requested_services, { multiple: true, class: "form-check-input service-checkbox", id: "service_activities" }, "Classified Activities", nil %>
      <%= form.label "requested_services_activities", "Submit Classified Activities Declaration", class: "form-check-label" %>
    </div>
  </div>
</div>

<div class="card p-5 mb-5 card-shadow" id="section_property_sale">
  <h4 class="mb-3">Property Sale Details</h4>
  
      <div class="form-floating mb-3">
    <%= form.text_area :selling_property_address, class: "form-control", placeholder: "Selling property address", style: "height: 120px;" %>
    <%= form.label :selling_property_address, "Selling Property Address" %>
     </div>
</div>

<div class="card p-5 mb-5 card-shadow" id="section_new_build">
  <h4 class="mb-3">New Build Declaration Information</h4>
  
    <div class="form-floating mb-3">
    <%= form.text_area :selling_property_address, class: "form-control", placeholder: "Selling property address", style: "height: 120px;" %>
    <%= form.label :selling_property_address, "Selling Property Address" %>
  </div>
      </div>

<div class="card p-5 mb-5 card-shadow" id="section_property_purchase"> 
  <h4 class="mb-3">Property Purchase Details</h4>
  <p class="mb-3">Enter the address of the property you intend to purchase:</p>
    <div class="form-floating mb-3">
    <%= form.text_area :buying_property_address, class: "form-control", placeholder: "Property address", style: "height: 120px;" %>
    <%= form.label :buying_property_address, "Property Address" %>
  </div>

  <p class="mt-3">What currency are your funds in?</p>
  <fieldset class="mb-3">
    <legend class="visually-hidden">Currency</legend>
    <div class="form-check form-check-inline">
      <%= form.radio_button :currency, 'EUR', id: 'currency_eur', class: 'form-check-input' %>
      <%= form.label :currency_eur, 'EUR (€)', class: 'form-check-label ms-1 me-4' %>
    </div>
    <div class="form-check form-check-inline">
      <%= form.radio_button :currency, 'GBP', id: 'currency_gbp', class: 'form-check-input' %>
      <%= form.label :currency_gbp, 'GBP (£)', class: 'form-check-label ms-1' %>
    </div>
  </fieldset>

  <p class="mt-3">Will you need a mortgage?</p>
  <fieldset class="mb-3">
    <legend class="visually-hidden">Apply for mortgage</legend>
    <div class="form-check form-check-inline">
      <%= form.radio_button :needs_mortgage, 'Yes', id: 'mortgage_yes', class: 'form-check-input' %>
      <%= form.label :mortgage_yes, 'Yes', class: 'form-check-label ms-1 me-3' %>
    </div>
    <div class="form-check form-check-inline">
      <%= form.radio_button :needs_mortgage, 'No', id: 'mortgage_no', class: 'form-check-input' %>
      <%= form.label :mortgage_no, 'No', class: 'form-check-label ms-1' %>
    </div>
  </fieldset>

  <p class="mt-3">Do you plan to rent the property as a holiday let?</p>
  <fieldset class="mb-3">
    <legend class="visually-hidden">Holiday let property</legend>
    <div class="form-check form-check-inline">
      <%= form.radio_button :wants_to_holiday_let, 'Yes', id: 'holiday_let_yes', class: 'form-check-input' %>
      <%= form.label :holiday_let_yes, 'Yes', class: 'form-check-label ms-1 me-3' %>
    </div>
    <div class="form-check form-check-inline">
      <%= form.radio_button :wants_to_holiday_let, 'No', id: 'holiday_let_no', class: 'form-check-input' %>
      <%= form.label :holiday_let_no, 'No', class: 'form-check-label ms-1' %>
    </div>
  </fieldset>
<%# Bank details section %>
<hr class="hr mb-3" style="color: #b29c84;" />
  <h4 class="mb-3">Bank details</h4>
  <p class="mb-3">
  Property purchase payments are typically made in three stages:

  </p>
  <ol class="ps-3 mb-4">
    <li><strong>Reservation fee</strong>  (1%) – to take the property off the market (estate‑agency sales only).</li>
    <li><strong>Deposit on exchange</strong> 9% (10% if no reservation fee) – due on exchange of contracts.</li>
    <li><strong>Balance on completion</strong> – the remaining amount on completion day.</li>
  </ol>
  <p class="mb-3">
    Under Spanish anti‑money‑laundering rules, the notary requires the bank name and IBAN of the account used for each payment 
    (e.g. HSBC, IBAN GB29 MIDL 4012 3456 7890 12).<br>
    Please fill in the details below for each payment stage.</p>

  <!-- 0) Reservation deposit question -->
  <fieldset class="mb-4">
    <legend class="col-form-label">
      Have you paid—or will you pay—a reservation fee
      (under an estate‑agent agreement, if applicable)?
    </legend>

    <div class="form-check form-check-inline">
      <%= form.radio_button :will_pay_reservation, 'yes',
            id: 'will_pay_res_yes',
            class: 'form-check-input' %>
      <%= form.label :will_pay_res_yes,
            'Yes',
            class: 'form-check-label ms-1 me-3' %>
    </div>

    <div class="form-check form-check-inline">
      <%= form.radio_button :will_pay_reservation, 'no',
            id: 'will_pay_res_no',
            class: 'form-check-input' %>
      <%= form.label :will_pay_res_no,
            'No',
            class: 'form-check-label ms-1' %>
    </div>
  </fieldset>

  <!-- 1) Reservation fee (only if Yes) -->
  <div id="reservation_section" style="display: none;">
    <div class="form-floating mb-3">
      <%= form.text_field :reservation_deposit_account,
            id: "reservation_deposit_account",
            class: "form-control",
            placeholder: "Enter reservation fee bank name and IBAN" %>
      <%= form.label :reservation_deposit_account, "Reservation fee account" %>
    </div>
  </div>

  <!-- 2) ALWAYS‑VISIBLE: Use same account? -->
  <div class="form-check mb-4">
    <%= form.check_box :use_same_account,
          { id: "use_same_account", class: "form-check-input" } %>
    <%= form.label :use_same_account,
          "Use the same account for all payments",
          class: "form-check-label" %>
  </div>

  <!-- 3) Deposit on exchange -->
  <div class="form-floating mb-3">
    <%= form.text_field :private_contract_account,
          id: "private_contract_account",
          class: "form-control",
          placeholder: "Enter deposit on exchange bank name and IBAN" %>
    <%= form.label :private_contract_account, "Deposit on exchange account" %>
  </div>

  <!-- 4) Balance on completion -->
  <div class="form-floating mb-1">
    <%= form.text_field :remaining_balance_account,
          id: "remaining_balance_account",
          class: "form-control",
          placeholder: "Enter balance on completion bank name and IBAN" %>
    <%= form.label :remaining_balance_account, "Balance on completion account" %>
  </div>

  <!-- 5) Spanish bank account? -->
  <fieldset class="mb-3">
    <legend class="col-form-label mb-2">
      Do you have a Spanish bank account for utilities standing orders?
    </legend>
    <div class="form-check form-check-inline">
      <%= form.radio_button :has_spanish_account, 'yes',
            id: 'has_spanish_yes',
            class: 'form-check-input' %>
      <%= form.label :has_spanish_yes,
            'Yes',
            class: 'form-check-label ms-1 me-3' %>
    </div>
    <div class="form-check form-check-inline">
      <%= form.radio_button :has_spanish_account, 'no',
            id: 'has_spanish_no',
            class: 'form-check-input' %>
      <%= form.label :has_spanish_no,
            'No',
            class: 'form-check-label ms-1' %>
    </div>
  </fieldset>

  <!-- 6) Utility standing order (only if Yes) -->
  <div id="utility_section" style="display: none;">
    <div class="form-floating mb-3">
      <%= form.text_field :utility_account,
            id: "utility_account",
            class: "form-control",
            placeholder: "Enter utility standing order bank name and IBAN" %>
      <%= form.label :utility_account, "Utility standing order account" %>
    </div>
  </div>


<script>
  document.addEventListener("turbo:load", () => {
    const payYes       = document.getElementById("will_pay_res_yes");
    const payNo        = document.getElementById("will_pay_res_no");
    const resSection   = document.getElementById("reservation_section");
    const sameBox      = document.getElementById("use_same_account");

    const payFee       = document.getElementById("reservation_deposit_account");
    const contractFld  = document.getElementById("private_contract_account");
    const balanceFld   = document.getElementById("remaining_balance_account");

    const hasSpanishYes = document.getElementById("has_spanish_yes");
    const utilSection   = document.getElementById("utility_section");

    // Show/hide reservation field
    function toggleReservationSection() {
      resSection.style.display = payYes.checked ? "block" : "none";
      syncAccounts();
    }

    // Show/hide utility field
    function toggleUtilitySection() {
      utilSection.style.display = hasSpanishYes.checked ? "block" : "none";
    }

    // Sync readonly & mirroring between fee / deposit / balance
    function syncAccounts() {
      if (!sameBox.checked) {
        [payFee, contractFld, balanceFld].forEach(f => f.removeAttribute("readonly"));
        return;
      }

      if (payYes.checked) {
        // copy from reservation fee
        [contractFld, balanceFld].forEach(f => {
          f.value = payFee.value;
          f.setAttribute("readonly", "readonly");
        });
      } else {
        // skip to deposit on exchange
        balanceFld.value = contractFld.value;
        balanceFld.setAttribute("readonly", "readonly");
        contractFld.removeAttribute("readonly");
      }
    }

    // Mirror inputs as user types
    function mirrorAccounts(e) {
      if (!sameBox.checked) return;
      if (e.target === payFee && payYes.checked) {
        [contractFld, balanceFld].forEach(f => f.value = payFee.value);
      } else if (e.target === contractFld && !payYes.checked) {
        balanceFld.value = contractFld.value;
      }
    }

    // Event listeners
    [payYes, payNo].forEach(rb => rb.addEventListener("change", toggleReservationSection));
    sameBox.addEventListener("change", syncAccounts);
    [payFee, contractFld].forEach(f => f.addEventListener("input", mirrorAccounts));
    hasSpanishYes.addEventListener("change", toggleUtilitySection);
    document.getElementById("has_spanish_no").addEventListener("change", toggleUtilitySection);

    // Initialize on load
    toggleReservationSection();
    toggleUtilitySection();
  });
</script>

</div>



    <%# PoA section %>
  <div class="card p-5 mb-5 card-shadow" id="section_poa">
  <h4 class="mb-3">Power of Attorney (PoA)</h4>
  <p class="mb-3">
By granting us a Power of Attorney, we'll handle everything for you.  </p>

  <!-- Q1: Grant PoA? -->
  <fieldset class="mb-3">
    <legend class="col-form-label">Would you like to grant us PoA?</legend>

    <div class="form-check mb-2">
      <%= form.radio_button :needs_poa, 'yes',
            id: 'needs_poa_yes',
            class: 'form-check-input' %>
      <%= form.label :needs_poa_yes,
            'Yes – please act on my behalf',
            class: 'form-check-label' %>
     </div>

    <div class="form-check mb-2">
      <%= form.radio_button :needs_poa, 'no',
            id: 'needs_poa_no',
            class: 'form-check-input' %>
      <%= form.label :needs_poa_no,
            'No – I do not require PoA',
            class: 'form-check-label' %>
     </div>

    <div class="form-check">
      <%= form.radio_button :needs_poa, 'already',
            id: 'needs_poa_already',
            class: 'form-check-input' %>
      <%= form.label :needs_poa_already,
            'Another person holds PoA and will act on my behalf – please let us know and send us a copy',
            class: 'form-check-label' %>
    </div>
  </fieldset>

  <!-- Follow‑up only if Q1 = Yes -->
  <div id="poa_details" style="display: none;">

    <!-- Q2: Scope of PoA -->
    <fieldset class="mb-3">
      <legend class="col-form-label">Which matters should your PoA cover?</legend>

      <div class="form-check mb-2">
        <%= form.radio_button :poa_for, 'buying',
              id: 'poa_for_buying',
              class: 'form-check-input' %>
        <%= form.label :poa_for_buying,
              'Buying – purchase property on my behalf',
              class: 'form-check-label' %>
  </div>

      <div class="form-check mb-2">
        <%= form.radio_button :poa_for, 'selling',
              id: 'poa_for_selling',
              class: 'form-check-input' %>
        <%= form.label :poa_for_selling,
              'Selling – sell property on my behalf',
              class: 'form-check-label' %>
     </div>

      <div class="form-check mb-2">
        <%= form.radio_button :poa_for, 'both',
              id: 'poa_for_both',
              class: 'form-check-input' %>
        <%= form.label :poa_for_both,
              'Buying & Selling – handle both purchase and sale',
              class: 'form-check-label' %>
      </div>

      <div class="form-check">
        <%= form.radio_button :poa_for, 'all',
              id: 'poa_for_all',
              class: 'form-check-input' %>
        <%= form.label :poa_for_all,
              'Buying, Selling & Mortgage – full conveyancing and mortgage powers',
              class: 'form-check-label' %>
      </div>
    </fieldset>

    <!-- Q3: Signing location -->
    <fieldset class="mb-3">
      <legend class="col-form-label">Where would you like to sign your PoA?</legend>

      <div class="form-check mb-2">
        <%= form.radio_button :poa_made_in_spain, 'yes',
              id: 'poa_spain_yes',
              class: 'form-check-input' %>
        <%= form.label :poa_spain_yes,
              'In Spain – sign before a Spanish notary with one of our team accompanying you',
              class: 'form-check-label' %>
      </div>

      <div class="form-check">
        <%= form.radio_button :poa_made_in_spain, 'no',
              id: 'poa_spain_no',
              class: 'form-check-input' %>
        <%= form.label :poa_spain_no,
              "At your local notary – we'll send a draft for you to sign and have it returned by courier",
              class: 'form-check-label' %>
      </div>
    </fieldset>

  </div>
</div>

<script>
  document.addEventListener("turbo:load", function() {
    const yesRadio     = document.getElementById("needs_poa_yes");
    const noRadio      = document.getElementById("needs_poa_no");
    const otherRadio   = document.getElementById("needs_poa_already");
    const poaDetails   = document.getElementById("poa_details");
    const poaSection   = document.getElementById("section_poa");
    
    // Service checkboxes that should trigger showing the PoA section
    const purchaseCheckbox = document.getElementById("service_purchase");
    const saleCheckbox = document.getElementById("service_sale");
    const newBuildCheckbox = document.getElementById("service_new_build");
    
    // NIE radio buttons
    const nieYesRadio = document.getElementById("needs_nie_yes");
    
    function togglePoADetails() {
      // Only show the details section if the Yes radio is checked
      if (poaDetails) {
        poaDetails.style.display = yesRadio.checked ? "block" : "none";
      }
    }
    
    function updatePoASectionVisibility() {
      // Show PoA section if:
      // 1. NIE "Yes" is selected OR
      // 2. Any of the relevant services are checked (purchase, sale, new build)
      const shouldShowPoA = 
        (nieYesRadio && nieYesRadio.checked) || 
        (purchaseCheckbox && purchaseCheckbox.checked) ||
        (saleCheckbox && saleCheckbox.checked) ||
        (newBuildCheckbox && newBuildCheckbox.checked);
      
      if (poaSection) {
        poaSection.style.display = shouldShowPoA ? "block" : "none";
      }
    }
    
    // Add event listeners for PoA radio buttons
    [yesRadio, noRadio, otherRadio].forEach(radio => {
      if (radio) {
        radio.addEventListener("change", togglePoADetails);
      }
    });
    
    // Add event listeners for the conditions that show/hide the entire section
    if (nieYesRadio) {
      nieYesRadio.addEventListener("change", updatePoASectionVisibility);
    }
    
    // Also listen to the "No" NIE option to potentially hide PoA
    const nieNoRadio = document.getElementById("needs_nie_no");
    if (nieNoRadio) {
      nieNoRadio.addEventListener("change", updatePoASectionVisibility);
    }
    
    // Add listeners to service checkboxes
    [purchaseCheckbox, saleCheckbox, newBuildCheckbox].forEach(checkbox => {
      if (checkbox) {
        checkbox.addEventListener("change", updatePoASectionVisibility);
      }
    });
    
    // Initialize both functions on page load
    togglePoADetails();
    updatePoASectionVisibility();
  });
</script>





<%# Will section %>
<div class="card p-5 mb-5 card-shadow" id="section_will">
  <h4>Last Will and Testament</h4>
  <p class="mb-3">
    Should you require a Will and Last Testament, kindly provide the necessary information below.<br>
  </p>

  <!-- 1) Are you currently married? -->
  <div class="mb-3">
    <%= form.label :currently_married, "Are you currently married?" %><br>
    <%= form.radio_button :currently_married, true,  id: "currently_married_true"  %>
    <%= form.label         :currently_married_true, "Yes", class: "form-check-label" %>
    &nbsp;
    <%= form.radio_button :currently_married, false, id: "currently_married_false" %>
    <%= form.label         :currently_married_false, "No",  class: "form-check-label" %>
  </div>

  <!-- If married, show this: -->
  <div id="current_spouse_section" style="display:none;">
    <div class="form-floating mb-3">
      <%= form.text_field :name_of_the_present_spouse,
           class: "form-control",
           placeholder: "Name of present spouse" %>
      <%= form.label :name_of_the_present_spouse, "Full name of present spouse" %>
    </div>
  </div>

  <!-- 2) Were you married before? -->
  <div class="mb-3">
    <%= form.label :previously_married, "Have you been married before?" %><br>
    <%= form.radio_button :previously_married, true,  id: "previously_married_true"  %>
    <%= form.label         :previously_married_true, "Yes", class: "form-check-label" %>
    &nbsp;
    <%= form.radio_button :previously_married, false, id: "previously_married_false" %>
    <%= form.label         :previously_married_false, "No",  class: "form-check-label" %>
  </div>

  <!-- If previously married, show this: -->
  <div id="previous_spouse_section" style="display:none;">
    <div class="form-floating mb-3">
      <%= form.text_field :name_of_the_previous_spouses,
           class: "form-control",
           placeholder: "Full name of previous spouse(s)" %>
      <%= form.label :name_of_the_previous_spouses, "Full name of previous spouse(s)" %>
    </div>
    <p class="m-2">If divorced, enter date of decree absolute:</p>
    <div class="form-floating mb-3">
      <%= form.date_field :date_of_divorce,
           class: "form-control",
           placeholder: "Date of divorce (DD/MM/YYYY)" %>
      <%= form.label :date_of_divorce, "Date of divorce" %>
    </div>
    <p class="m-2">If widowed, enter date of spouse's death:</p>
    <div class="form-floating mb-3">
      <%= form.date_field :date_of_decease,
           class: "form-control",
           placeholder: "Date of death (DD/MM/YYYY)" %>
      <%= form.label :date_of_decease, "Date of death" %>
    </div>
  </div>

  <!-- 3) Parental Details -->
  <!-- Father's Vital Status -->
<div class="mb-3">
  <%= form.label :father_s_vital_status, "Is your father alive?" %><br>

  <div class="form-check form-check-inline">
    <%= form.radio_button :father_s_vital_status, "Yes",
         id: "father_vital_status_living",
         class: "form-check-input" %>
    <%= form.label "father_vital_status_living", "Yes",
         class: "form-check-label" %>
  </div>

  <div class="form-check form-check-inline">
    <%= form.radio_button :father_s_vital_status, "No",
         id: "father_vital_status_deceased",
         class: "form-check-input" %>
    <%= form.label "father_vital_status_deceased", "No",
         class: "form-check-label" %>
  </div>
</div>

<!-- Mother's Vital Status -->
<div class="mb-3">
  <%= form.label :mother_s_vital_status, "Is your mother alive?" %><br>

  <div class="form-check form-check-inline">
    <%= form.radio_button :mother_s_vital_status, "Yes",
         id: "mother_vital_status_living",
         class: "form-check-input" %>
    <%= form.label "mother_vital_status_living", "Yes",
         class: "form-check-label" %>
  </div>

  <div class="form-check form-check-inline">
    <%= form.radio_button :mother_s_vital_status, "No",
         id: "mother_vital_status_deceased",
         class: "form-check-input" %>
    <%= form.label "mother_vital_status_deceased", "No",
         class: "form-check-label" %>
  </div>
</div>

  <!-- 4) Children & Dependents -->
  <div class="form-floating mb-3">
    <%= form.text_field :children,
         class: "form-control",
         placeholder: "Children (Name | DOB DD/MM/YYYY)" %>
    <%= form.label :children, "Children & dependents" %>
  </div>

  <!-- 5) Bequests & Order of Succession -->
<p>
  List the individuals or organisations you wish to inherit your estate, along with the item and percentage each should receive.<br>
  You may also name an alternative beneficiary in case someone is unable to inherit.
</p>

<p class="mb-2">
  <strong>Example:</strong><br>
  All assets in Spain: John Smith – 50%, Anna Smith – 50%.<br>
  If John is unable to inherit, his share should pass to James Clarke.
</p>


  <div class="form-floating mb-3">
    <%= form.text_area :outline_of_bequests_and_oder_of_success,
         class: "form-control",
         placeholder: "Outline of Bequests & Order of Succession" %>
    <%= form.label :outline_of_bequests_and_oder_of_success, "Beneficiaries & gifts" %>
  </div>

  <!-- 6) Governing Law -->
  <p class="mb-2">Select the country whose laws you would like to govern your inheritance:</p>
  <div class="form-floating mb-3">
    <%= form.select :inheritance_to_be_governed_by,
         [
           ["Law of country of current nationality","Law of country of current nationality"],
           ["Nationality at the time of death","Nationality at the time of death"],
           ["Habitual place of residence at the time of death","Habitual place of residence at the time of death"]
         ],
         { include_blank: "Select" },
         class: "form-control form-select" %>
    <%= form.label :inheritance_to_be_governed_by, "Inheritance governed by" %>
    <p class="m-2 small-text">
      Most people making a will choose the "Law of their current nationality".
    </p>
  </div>
</div>

<script>
  document.addEventListener("turbo:load", function() {
    function toggleSection(yesId, sectionId) {
      var yes     = document.getElementById(yesId);
      var no      = document.getElementById(yesId.replace("_true","_false"));
      var section = document.getElementById(sectionId);
      function update() {
        section.style.display = yes.checked ? "block" : "none";
      }
      yes.addEventListener("change", update);
      no .addEventListener("change", update);
      update();
    }

    toggleSection("currently_married_true",  "current_spouse_section");
    toggleSection("previously_married_true", "previous_spouse_section");
  });
</script>





<%# VV License section %>
  <div class="card p-5 mb-5 card-shadow" id="section_documents">
    <h4>Documents</h4>
    <p class="mb-5">Documents need to be uploaded:</p>
    
    <fieldset class="mb-3">
      <legend class="col-form-label mb-2">Can you provide the Title Deed (Escritura)?</legend>

      <div class="form-check mb-2">
        <%= form.radio_button :escritura, 'Provided',
              id: 'title_deed_upload_now',
              class: 'form-check-input' %>
        <%= form.label :title_deed_upload_now,
              'Yes, I will upload it now',
              class: 'form-check-label' %>
      </div>

      <div class="form-check mb-2">
        <%= form.radio_button :escritura, 'Client Will Provide',
              id: 'title_deed_send_later',
              class: 'form-check-input' %>
        <%= form.label :title_deed_send_later,
              'Yes, but I will send it later',
              class: 'form-check-label' %>
      </div>

      <div class="form-check mb-2">
        <%= form.radio_button :escritura, 'Client Cannot Find It',
              id: 'title_deed_cant_find',
              class: 'form-check-input' %>
        <%= form.label :title_deed_cant_find,
              'I can\'t find it',
              class: 'form-check-label' %>
      </div>
    </fieldset>

    <div class="rounded mb-3" id="title_deed_upload_section">
      <p>Upload Title Deed (Escritura)</p>
      <div class="file-upload-container">
        <label for="user_title_deed_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
          <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :title_deed_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
    </div>
    
    <div class="rounded mb-3">
      <p>Upload Nota Simple (Land Registry Ownership Certificate)</p>
      <div class="file-upload-container">
        <label for="user_nota_simple_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
          <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :nota_simple_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
    </div>

    <fieldset class="mb-3">
      <legend class="col-form-label mb-2">Do you have the Energy Efficiency Certificate (CEE)?</legend>
            <p class="text-muted">If you do not have this document, our office can manage the application on your behalf through a certified technician.</p>

      <div class="form-check mb-2">
        <%= form.radio_button :energy_efficiency_certificate_cee, 'Provided',
              id: 'cee_upload_now',
              class: 'form-check-input' %>
        <%= form.label :cee_upload_now,
              'Yes, I will upload it now',
              class: 'form-check-label' %>
      </div>

      <div class="form-check mb-2">
        <%= form.radio_button :energy_efficiency_certificate_cee, 'Client Will Provide',
              id: 'cee_send_later',
              class: 'form-check-input' %>
        <%= form.label :cee_send_later,
              'Yes, but I will send it later',
              class: 'form-check-label' %>
      </div>

      <div class="form-check mb-2">
        <%= form.radio_button :energy_efficiency_certificate_cee, 'We Need to Apply',
              id: 'cee_need_to_apply',
              class: 'form-check-input' %>
        <%= form.label :cee_need_to_apply,
              'No, please obtain one on my behalf',
              class: 'form-check-label' %>
      </div>
    </fieldset>

    <div class="rounded mb-3" id="cee_upload_section">
      <p class="mb-2">Upload Energy Efficiency Certificate (CEE)</p>
      <div class="file-upload-container">
        <label for="user_cee_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
                 <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :cee_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3" id="vv_license_upload_section">
      <p>Upload VV License</p>
      
      <div class="file-upload-container">
        <label for="user_vv_license_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
       <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :vv_license_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3">
      <p class="mb-2">Upload First Occupation License</p>
      <p class="text-muted">If you do not have this document, our office can manage the application on your behalf and liaise with the relevant authorities.</p>
      <div class="file-upload-container">
        <label for="user_first_occupation_license_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
                 <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :first_occupation_license_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3">
      <p>Upload Habitability Certificate</p>
      <div class="file-upload-container">
        <label for="user_habitability_certificate_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
                <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :habitability_certificate_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <%# Municipal Certificate section is commented out 
    <div class="rounded mb-3">
      <p>Upload Municipal Certificate</p>
      <div class="file-upload-container">
        <label for="user_municipal_certificate_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
                <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :municipal_certificate_documents, multiple: true, class: "file-upload-input" 
        </label> 
      </div>
      </div> %>
    
    <div class="rounded mb-3">
      <p>Upload Annual Property Tax Receipt (IBI)</p>
      <div class="file-upload-container">
        <label for="user_property_tax_receipt_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
                 <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :property_tax_receipt_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3">
      <p>Upload Floor Plan</p>
      <div class="file-upload-container">
        <label for="user_floor_plan_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
       <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>        
           <%= form.file_field :floor_plan_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3">
      <p>Upload Community Approval</p>
      <div class="file-upload-container">
        <label for="user_community_approval_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
       <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
                    <%= form.file_field :community_approval_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3" id="civil_liability_section">
      <p>Upload Civil Liability Insurance Policy</p>
      <div class="file-upload-container">
        <label for="user_civil_liability_insurance_policy_documents" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
             <span class="upload-text">Upload files or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :civil_liability_insurance_policy_documents, multiple: true, class: "file-upload-input" %>
        </label>
      </div>
      </div>

    <div class="rounded mb-3" id="igic_registration_section">
      <p>Upload IGIC Registration (Modelo 400)</p>
      <div class="file-upload-container">
        <label for="user_igic_registration_modelo_400_document" class="file-upload-label">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="grey" style="width: 1em; height: 1em;"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3 192 320c0 17.7 14.3 32 32 32s32-14.3 32-32l0-210.7 73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-64z"/></svg>
          </div>
         <span class="upload-text">Upload a file or drag & drop</span>
          <span class="file-types">PDF, JPG, PNG</span>
          <%= form.file_field :igic_registration_modelo_400_document, class: "file-upload-input" %>
        </label>
      </div>
    </div>
  </div>

  <div class="d-grid  mb-3">
    <%= form.submit "Submit", class:"btn btn-lg mb-2", style:"background-color: #b29c84; color: white;" %>
  </div>

 <div class="mb-5">
 Have any questions? <a href="wa.me/+34649948377" style="color: #b29c84; text-decoration: none; font-weight: 500;">Send me a WhatsApp</a>
  </div>
  <p class="mt-5 mb-3 text-muted text-center">Roper Lawyers &copy; 2010-<%= Date.today.year %></p>
 </div >
  </div>
  </div>
   <% end %>

    <script>
        document.addEventListener("turbo:load", function() {
            const dateOfBirthField = document.getElementById("dateOfBirthField");
            const dateOfBirthError = document.getElementById("dateOfBirthError");

            dateOfBirthField.addEventListener("input", function() {
                const inputDate = dateOfBirthField.value;
                const isValidFormat = dateOfBirthField.checkValidity();

                if (isValidFormat) {
                    const dateParts = inputDate.split("-");
                    const year = parseInt(dateParts[0]);
                    const month = parseInt(dateParts[1]);
                    const day = parseInt(dateParts[2]);

                    if (year >= 1900 && year <= 2020 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                        dateOfBirthError.textContent = ""; // Clear the error message
                    } else {
                        dateOfBirthError.textContent = "Invalid date. Please choose a valid date for your date of birth!";
                    }
                } else {
                    dateOfBirthError.textContent = "Please use the format YYYY-MM-DD.";
                }
            });
        });
    </script>

<script>
  document.addEventListener("turbo:load", function() {
    // Sections to control
    const sections = {
      purchase: document.getElementById('section_property_purchase'),
      sale: document.getElementById('section_property_sale'),
      newBuild: document.getElementById('section_new_build'),
      will: document.getElementById('section_will'),
      shortTerm: document.getElementById('section_short_term'),
      documents: document.getElementById('section_documents')
    };
    
    // Service checkboxes
    const checkboxes = {
      purchase: document.getElementById('service_purchase'),
      sale: document.getElementById('service_sale'),
      newBuild: document.getElementById('service_new_build'),
      will: document.getElementById('service_will'),
      vv: document.getElementById('service_vv'),
      registry: document.getElementById('service_registry'),
      activities: document.getElementById('service_activities')
    };
    
    // Special sections that depend on specific checkboxes
    const vvLicenseUploadSection = document.getElementById('vv_license_upload_section');
    const civilLiabilitySection = document.getElementById('civil_liability_section');
    const igicRegistrationSection = document.getElementById('igic_registration_section');
    
    // Hide all conditional sections initially
    Object.values(sections).forEach(section => {
      if (section) {
        section.style.display = 'none';
      }
    });
    
    // Function to update section visibility
    function updateSections() {
      // Show/hide Purchase section
      if (sections.purchase) {
        sections.purchase.style.display = checkboxes.purchase.checked ? 'block' : 'none';
      }
      
      // Show/hide Sale section
      if (sections.sale) {
        sections.sale.style.display = checkboxes.sale.checked ? 'block' : 'none';
      }
      
      // Show/hide New Build section
      if (sections.newBuild) {
        sections.newBuild.style.display = checkboxes.newBuild.checked ? 'block' : 'none';
      }
      
      // Show/hide Will section
      if (sections.will) {
        sections.will.style.display = checkboxes.will.checked ? 'block' : 'none';
      }
      
      // Show/hide Short Term section if any related service is checked
      if (sections.shortTerm) {
        sections.shortTerm.style.display = 
          (checkboxes.vv.checked || checkboxes.registry.checked || checkboxes.activities.checked) 
            ? 'block' : 'none';
      }
      
      // Show/hide Documents section (show only when Sale or any short-term compliance service is selected)
      if (sections.documents) {
        sections.documents.style.display = 
          (checkboxes.sale.checked || checkboxes.vv.checked || checkboxes.registry.checked || checkboxes.activities.checked) 
            ? 'block' : 'none';
      }
      
      // Show VV License upload ONLY when Unified Registry or Classified Activities is selected
      if (vvLicenseUploadSection) {
        vvLicenseUploadSection.style.display = 
          (checkboxes.registry.checked || checkboxes.activities.checked) ? 'block' : 'none';
      }
      
      // Hide Civil Liability and IGIC sections when only selling (but show them for holiday lets)
      const isOnlySelling = checkboxes.sale.checked && 
                            !checkboxes.vv.checked && 
                            !checkboxes.registry.checked && 
                            !checkboxes.activities.checked;
      
      if (civilLiabilitySection) {
        civilLiabilitySection.style.display = isOnlySelling ? 'none' : 'block';
      }
      
      if (igicRegistrationSection) {
        igicRegistrationSection.style.display = isOnlySelling ? 'none' : 'block';
      }
    }
    
    // Add event listeners to all checkboxes
    Object.values(checkboxes).forEach(checkbox => {
      if (checkbox) {
        checkbox.addEventListener('change', updateSections);
      }
    });
    
    // Run initially to set up correct state
    updateSections();
    
    // If there are any pre-selected services (e.g., when editing), show those sections
    if (checkboxes.purchase && checkboxes.purchase.checked) sections.purchase.style.display = 'block';
    if (checkboxes.sale && checkboxes.sale.checked) sections.sale.style.display = 'block';
    if (checkboxes.newBuild && checkboxes.newBuild.checked) sections.newBuild.style.display = 'block';
    if (checkboxes.will && checkboxes.will.checked) sections.will.style.display = 'block';
    if ((checkboxes.vv && checkboxes.vv.checked) || 
        (checkboxes.registry && checkboxes.registry.checked) || 
        (checkboxes.activities && checkboxes.activities.checked)) {
      if (sections.shortTerm) sections.shortTerm.style.display = 'block';
    }
    
    // Initial state for VV License upload section
    if (vvLicenseUploadSection && (checkboxes.registry || checkboxes.activities)) {
      vvLicenseUploadSection.style.display = 
        (checkboxes.registry.checked || checkboxes.activities.checked) ? 'block' : 'none';
    }
    
    // Initial state for Documents section
    if (sections.documents) {
      sections.documents.style.display = 
        (checkboxes.sale.checked || checkboxes.vv.checked || checkboxes.registry.checked || checkboxes.activities.checked) 
          ? 'block' : 'none';
    }
    
    // Initial state for Civil Liability and IGIC sections
    const isOnlySelling = checkboxes.sale && checkboxes.sale.checked && 
                        !(checkboxes.vv && checkboxes.vv.checked) && 
                        !(checkboxes.registry && checkboxes.registry.checked) && 
                        !(checkboxes.activities && checkboxes.activities.checked);
    
    if (civilLiabilitySection) {
      civilLiabilitySection.style.display = isOnlySelling ? 'none' : 'block';
    }
    
    if (igicRegistrationSection) {
      igicRegistrationSection.style.display = isOnlySelling ? 'none' : 'block';
    }
  });
</script>

<style>
  .file-upload-label.dragover {
    border-color: #2684FF;
    background-color: rgba(38, 132, 255, 0.05);
  }
  
  .file-info {
    font-size: 0.85rem;
    color: #333;
    word-break: break-all;
  }
  
  .delete-file {
    padding: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  
  .delete-file:hover {
    transform: scale(1.2);
  }
  
  .file-list {
    text-align: left;
  }
  
  .file-item {
    font-size: 0.85rem;
  }
</style>

<script>
  document.addEventListener("turbo:load", function() {
    const dateOfBirthField = document.getElementById("dateOfBirthField");
    const dateOfBirthError = document.getElementById("dateOfBirthError");

    if (dateOfBirthField && dateOfBirthError) {
      dateOfBirthField.addEventListener("input", function() {
        const inputDate = dateOfBirthField.value;
        const isValidFormat = dateOfBirthField.checkValidity();

        if (isValidFormat) {
          const dateParts = inputDate.split("-");
          const year = parseInt(dateParts[0]);
          const month = parseInt(dateParts[1]);
          const day = parseInt(dateParts[2]);

          if (year >= 1900 && year <= 2020 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
            dateOfBirthError.textContent = ""; // Clear the error message
          } else {
            dateOfBirthError.textContent = "Invalid date. Please choose a valid date for your date of birth!";
          }
        } else {
          dateOfBirthError.textContent = "Please use the format YYYY-MM-DD.";
        }
      });
    }
  });
</script>

<style>
  .hidden-section {
    display: none !important;
  }
</style>

<script>
  document.addEventListener("turbo:load", function() {
    const uploadNowRadio = document.getElementById("cee_upload_now");
    const sendLaterRadio = document.getElementById("cee_send_later");
    const needToApplyRadio = document.getElementById("cee_need_to_apply");
    const ceeUploadSection = document.getElementById("cee_upload_section");

    function toggleCeeUploadSection() {
      // Only show the upload section if "Yes, I will upload it now" is selected
      if (ceeUploadSection) {
        ceeUploadSection.style.display = uploadNowRadio && uploadNowRadio.checked ? "block" : "none";
      }
    }

    if (uploadNowRadio && sendLaterRadio && needToApplyRadio) {
      uploadNowRadio.addEventListener("change", toggleCeeUploadSection);
      sendLaterRadio.addEventListener("change", toggleCeeUploadSection);
      needToApplyRadio.addEventListener("change", toggleCeeUploadSection);
    }

    // Initialize on load
    toggleCeeUploadSection();
  });
</script>

<style>
  .file-upload-label.dragover {
</style>

<script>
  document.addEventListener("turbo:load", function() {
    // Title Deed section toggle
    const titleDeedUploadNowRadio = document.getElementById("title_deed_upload_now");
    const titleDeedSendLaterRadio = document.getElementById("title_deed_send_later");
    const titleDeedCantFindRadio = document.getElementById("title_deed_cant_find");
    const titleDeedUploadSection = document.getElementById("title_deed_upload_section");

    function toggleTitleDeedUploadSection() {
      // Only show the upload section if "Yes, I will upload it now" is selected
      if (titleDeedUploadSection) {
        titleDeedUploadSection.style.display = titleDeedUploadNowRadio && titleDeedUploadNowRadio.checked ? "block" : "none";
      }
    }

    if (titleDeedUploadNowRadio && titleDeedSendLaterRadio && titleDeedCantFindRadio) {
      titleDeedUploadNowRadio.addEventListener("change", toggleTitleDeedUploadSection);
      titleDeedSendLaterRadio.addEventListener("change", toggleTitleDeedUploadSection);
      titleDeedCantFindRadio.addEventListener("change", toggleTitleDeedUploadSection);
    }

    // Initialize on load
    toggleTitleDeedUploadSection();
    
    // CEE section toggle
    const ceeUploadNowRadio = document.getElementById("cee_upload_now");
    const ceeSendLaterRadio = document.getElementById("cee_send_later");
    const ceeNeedToApplyRadio = document.getElementById("cee_need_to_apply");
    const ceeUploadSection = document.getElementById("cee_upload_section");

    function toggleCeeUploadSection() {
      // Only show the upload section if "Yes, I will upload it now" is selected
      if (ceeUploadSection) {
        ceeUploadSection.style.display = ceeUploadNowRadio && ceeUploadNowRadio.checked ? "block" : "none";
      }
    }

    if (ceeUploadNowRadio && ceeSendLaterRadio && ceeNeedToApplyRadio) {
      ceeUploadNowRadio.addEventListener("change", toggleCeeUploadSection);
      ceeSendLaterRadio.addEventListener("change", toggleCeeUploadSection);
      ceeNeedToApplyRadio.addEventListener("change", toggleCeeUploadSection);
    }

    // Initialize on load
    toggleCeeUploadSection();
  });
</script>
