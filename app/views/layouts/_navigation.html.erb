<!-- Top Bar -->
<div class="fixed-top bg-light" style="padding: 6px 0; font-size: 1rem; z-index: 1030; height: 38px; margin: 0; border: none;">
  <div class="container" style="height: 100%;">
    <div class="d-flex justify-content-between align-items-center h-100">
      <!-- Phone numbers (left) -->
      <div class="d-flex gap-4">
        <a class="text-dark text-decoration-none" href="tel:+442081358218">
          ðŸ‡¬ðŸ‡§ +44 20 8135 8218
        </a>
        <a class="text-dark text-decoration-none" href="tel:+34928974241">
          ðŸ‡ªðŸ‡¸ +34 928 97 42 41
        </a>
      </div>
      
      
      <!-- Client Login (right) -->
      <div>
        <% if user_signed_in? %>
          <span class="text-muted me-3"><%= current_user.email %></span>
          <%= link_to 'Dashboard', edit_user_path(current_user), class: "text-dark text-decoration-none me-2" %>
          <%= link_to "Logout", destroy_user_session_path, class: "text-dark text-decoration-none", method: :delete %>
        <% else %>
          <%= link_to "Client Login", new_user_session_path, class: "text-dark text-decoration-none" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<nav class="navbar navbar-expand-lg fixed-top navbar-light bg-white" style="top: 38px; margin: 0; padding: 0.5rem 0; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <div class="container">
      <a class="navbar-brand" href="/" style="font-family: 'Times New Roman', serif; color: #b29c84 !important; font-weight: normal; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 0.2em;">Roper Lawyers</a>

      <!-- Hamburger menu button for mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" style="border: none;">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <!-- Main navigation items (desktop left) -->
        <ul class="navbar-nav me-auto d-none d-lg-flex">
          <!-- About Us Dropdown -->
          <li class="nav-item dropdown" onmouseover="showDropdown(this)" onmouseout="hideDropdown(this)">
            <a class="nav-link dropdown-toggle text-dark" href="/our-story" id="aboutDropdown" role="button" 
               aria-expanded="false">
              About Us
            </a>
            <ul class="dropdown-menu" aria-labelledby="aboutDropdown">
              <li><a class="dropdown-item" href="/our-story">Our Story</a></li>
              <li><a class="dropdown-item" href="/team">Meet the Team</a></li>
              <li><a class="dropdown-item" href="/why-choose-us">Why Choose Us</a></li>
            </ul>
          </li>
          
          <!-- Buying Property -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold" href="/buying-property">Buying Property</a>
          </li>
          
          <!-- Holiday Rental Licences -->
          <li class="nav-item">
            <a class="nav-link text-dark" href="/holiday-rental-license">
              Holiday Rental Licences
            </a>
          </li>
          
          <!-- Services Dropdown -->
          <li class="nav-item dropdown" onmouseover="showDropdown(this)" onmouseout="hideDropdown(this)">
            <a class="nav-link dropdown-toggle text-dark" href="/services" id="servicesDropdown" role="button" 
               aria-expanded="false">
              Services
            </a>
            <ul class="dropdown-menu" aria-labelledby="servicesDropdown">
              <li><a class="dropdown-item" href="/selling-property">Selling Property</a></li>
              <li><a class="dropdown-item" href="/wills">Wills</a></li>
              <li><a class="dropdown-item" href="/inheritance">Inheritance</a></li>
              <li><a class="dropdown-item" href="/new-build-registration">New-Build Registration</a></li>
            </ul>
          </li>
          
          <!-- Guides Dropdown -->
          <li class="nav-item dropdown" onmouseover="showDropdown(this)" onmouseout="hideDropdown(this)">
            <a class="nav-link dropdown-toggle text-dark" href="#" id="guidesDropdown" role="button" 
               aria-expanded="false">
              Guides
            </a>
            <ul class="dropdown-menu" aria-labelledby="guidesDropdown">
              <li><a class="dropdown-item" href="/property-buying-guide">How to Buy Property in Spain</a></li>
              <li><a class="dropdown-item" href="/holiday-rental-rules-2025">Holiday Rental Rules 2025</a></li>
              <li><a class="dropdown-item" href="/blog">Blog & News</a></li>
            </ul>
          </li>
          
          <!-- Reviews -->
          <li class="nav-item">
            <a class="nav-link text-dark" href="/reviews">Reviews</a>
          </li>
          
          <!-- Contact -->
          <li class="nav-item dropdown" onmouseover="showDropdown(this)" onmouseout="hideDropdown(this)">
            <a class="nav-link dropdown-toggle text-dark" href="/contact" id="contactDropdown" role="button" 
               aria-expanded="false">
              Contact
            </a>
            <ul class="dropdown-menu" aria-labelledby="contactDropdown">
              <li><a class="dropdown-item" href="/contact">Contact Page</a></li>
              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Quick Message</a></li>
            </ul>
          </li>
        </ul>

        <!-- Mobile navigation items -->
        <ul class="navbar-nav w-100 d-lg-none">
          <!-- Mobile consultation button at top -->
          <li class="nav-item mb-3">
            <a class="btn w-100 fw-bold py-3 rounded-pill" href="#" data-bs-toggle="modal" data-bs-target="#contactModal" 
               style="background-color: #b29c84; border-color: #b29c84; color: white; font-size: 1.1rem;">
              Free Consultation
            </a>
          </li>
          
          <!-- About Us -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold" href="/our-story">About Us</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/our-story">Our Story</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/team">Meet the Team</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/why-choose-us">Why Choose Us</a>
          </li>
          
          <!-- Reviews -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold" href="/reviews">Reviews</a>
          </li>
          
          <!-- Services -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold">Services</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/buying-property">Buying Property</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/selling-property">Selling Property</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/wills">Wills</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/inheritance">Inheritance</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/new-build-registration">New-Build Registration</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/holiday-rental-license">Holiday Rental License (VV)</a>
          </li>
          
          <!-- Guides -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold">Guides</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/property-buying-guide">Property Buying Guide</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/holiday-rental-rules-2025">Holiday Rental Rules 2025</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="/blog">Blog & News</a>
          </li>
          
          <!-- Contact -->
          <li class="nav-item">
            <a class="nav-link text-dark fw-bold" href="/contact">Contact</a>
          </li>
          <li class="nav-item ps-3">
            <a class="nav-link text-muted" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Quick Message</a>
          </li>
          
          <!-- Free Consultation -->
          <li class="nav-item mt-3">
            <a href="/free-consultation"
               class="btn w-100 fw-bold py-2 rounded-pill text-decoration-none" 
               style="background-color: #b39c84; border-color: #b39c84; color: white;">
              Book Free Consultation
            </a>
          </li>
        </ul>

        <!-- Desktop Free Consultation button (far right) -->
        <ul class="navbar-nav ms-auto d-none d-lg-flex">
          <li class="nav-item">
            <a href="/free-consultation"
               class="btn rounded-pill d-flex align-items-center justify-content-center text-decoration-none" 
               style="background-color: #b39c84; border: none; color: white; padding: 0.75rem 1.5rem; font-size: 1.125rem; width: fit-content; min-height: 48px; transition: background-color 0.2s ease;">
              <span style="font-size: 1.125rem; font-weight: 500; letter-spacing: 0.8px;">Book Free Consultation</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- Calendly widget assets -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    
    <!-- Google Calendar Button Styling -->
    <style>
      /* Force white text on Google Calendar buttons */
      .calendar-btn-white-text,
      .calendar-btn-white-text *,
      [data-calendar-button] *,
      [data-calendar-button],
      div[id*="consultation-btn"] a,
      div[id*="consultation-btn"] a *,
      div[id*="consultation-btn"] button,
      div[id*="consultation-btn"] button * {
        color: white !important;
        text-decoration: none !important;
      }
      
      /* Additional specificity for Google Calendar generated elements */
      div[style*="background-color: #b29c84"] a,
      div[style*="background-color: #b29c84"] a *,
      div[style*="background-color: #b39c84"] a,
      div[style*="background-color: #b39c84"] a * {
        color: white !important;
      }
    </style>
</nav>

<script>
function showDropdown(element) {
  const dropdown = element.querySelector('.dropdown-menu');
  const toggle = element.querySelector('.dropdown-toggle');
  
  if (dropdown && toggle) {
    dropdown.classList.add('show');
    toggle.setAttribute('aria-expanded', 'true');
  }
}

function hideDropdown(element) {
  const dropdown = element.querySelector('.dropdown-menu');
  const toggle = element.querySelector('.dropdown-toggle');
  
  if (dropdown && toggle) {
    dropdown.classList.remove('show');
    toggle.setAttribute('aria-expanded', 'false');
  }
}

// Enhanced dropdown functionality
document.addEventListener('DOMContentLoaded', function() {
  const dropdowns = document.querySelectorAll('.dropdown-menu');
  
  dropdowns.forEach(function(dropdown) {
    dropdown.addEventListener('mouseenter', function() {
      this.classList.add('show');
      const toggle = this.parentElement.querySelector('.dropdown-toggle');
      if (toggle) {
        toggle.setAttribute('aria-expanded', 'true');
      }
    });
    
    dropdown.addEventListener('mouseleave', function() {
      this.classList.remove('show');
      const toggle = this.parentElement.querySelector('.dropdown-toggle');
      if (toggle) {
        toggle.setAttribute('aria-expanded', 'false');
      }
    });
  });
  
  // Allow clicks on dropdown toggles with href attributes
  const dropdownToggles = document.querySelectorAll('.dropdown-toggle[href]:not([href="#"])');
  dropdownToggles.forEach(function(toggle) {
    toggle.addEventListener('click', function(e) {
      // Only prevent default if the link is empty or just #
      if (!this.href || this.href.endsWith('#')) {
        e.preventDefault();
      }
      // If it has a real href, let it navigate normally
    });
  });
});
</script>

<style>
/* Force no gaps between navigation elements */
.fixed-top.bg-light {
  margin: 0 !important;
  padding: 6px 0 !important;
  border: none !important;
  height: 38px !important;
}

nav.navbar {
  margin: 0 !important;
  border: none !important;
  padding: 0.5rem 0 !important;
}

/* Ensure seamless connection */
.fixed-top.bg-light + nav.navbar {
  border-top: none !important;
  margin-top: 0 !important;
}

/* Adjust body padding for seamless header */
body {
  padding-top: 94px !important; /* 38px top bar + 56px navbar exactly */
}

/* Mobile adjustments */
@media (max-width: 991.98px) {
  body {
    padding-top: 94px !important;
  }
  
  /* Hide top bar on mobile to save space */
  .fixed-top.bg-light {
    display: none;
  }
  
  /* Adjust main navbar position on mobile */
  nav.navbar {
    top: 0 !important;
  }
  
  body {
    padding-top: 56px !important; /* Just navbar height on mobile */
  }
}
</style>